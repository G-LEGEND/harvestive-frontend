<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Withdraw</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .withdraw-container { padding: 20px; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
    .form-group input, .form-group select {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="withdraw-container">
    <h2>Withdraw</h2>

    <div class="form-group">
      <label for="withdrawMethod">Select Method</label>
      <select id="withdrawMethod">
        <option value="BTC">Bitcoin (BTC)</option>
        <option value="USDT">Tether (USDT)</option>
      </select>
    </div>

    <div class="form-group">
      <label for="withdrawAmount">Amount (min $20,000)</label>
      <input type="number" id="withdrawAmount" placeholder="Enter amount">
    </div>

    <div class="form-group">
      <label for="withdrawAddress">Your Wallet Address</label>
      <input type="text" id="withdrawAddress" placeholder="Enter your BTC/USDT address">
    </div>

    <button class="gold-btn" onclick="submitWithdraw()">Submit Withdraw</button>
  </div>

  <div class="bottom-nav">
    <a href="deposit.html"><i class="fas fa-wallet"></i><br>Deposit</a>
    <a href="invest.html"><i class="fas fa-piggy-bank"></i><br>My invest</a>
    <a href="dashboard.html"><i class="fas fa-home"></i><br>Home</a>
    <a href="withdraw.html" class="active"><i class="fas fa-money-bill"></i><br>Withdraw</a>
    <a href="transfer.html"><i class="fas fa-exchange-alt"></i><br>Transfer</a>
  </div>

  <script>
    async function submitWithdraw() {
      const method = document.getElementById("withdrawMethod").value;
      const amount = parseFloat(document.getElementById("withdrawAmount").value);
      const address = document.getElementById("withdrawAddress").value.trim();

      if (!amount || amount < 20000) {
        alert("❌ Minimum withdrawal is $20,000");
        return;
      }
      if (!address) {
        alert("❌ Please enter your wallet address");
        return;
      }

      const token = localStorage.getItem("token");
      if (!token) {
        alert("You must be logged in.");
        window.location.href = "index.html";
        return;
      }

      try {
        const res = await fetch("https://harvestive-co-backend.onrender.com/withdraw", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({ amount, method, address })
        });

        const data = await res.json();
        if (res.ok) {
          alert("✅ Withdraw request submitted! Pending admin approval.");
          window.location.href = "log.html"; // redirect to logs
        } else {
          alert("❌ " + (data.error || "Withdraw failed."));
        }
      } catch (err) {
        console.error(err);
        alert("⚠️ Error connecting to server.");
      }
    }
  </script>
</body>
</html>